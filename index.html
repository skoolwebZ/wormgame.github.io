<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slither.io By Josh J</title>
<style>
  html, body { margin:0; padding:0; overflow:hidden; font-family:sans-serif; background:#111; color:#fff; }
  canvas { display:block; background:#111; }
  #ui { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; }
  button { padding:10px 20px; margin:10px; font-size:18px; cursor:pointer; }
  #colorPicker { margin:10px; }
  #joystick { position:absolute; bottom:50px; left:50px; width:100px; height:100px; border-radius:50%; background:rgba(255,255,255,0.2); touch-action:none; }
  #stick { position:absolute; width:50px; height:50px; border-radius:50%; background:rgba(255,255,255,0.5); top:25px; left:25px; }
</style>
</head>
<body>
<div id="ui">
  <h1>Slither.io By Josh J</h1>
  <div>Choose your snake color:</div>
  <div>
    <button style="background:red;" onclick="selectColor('red')"></button>
    <button style="background:blue;" onclick="selectColor('blue')"></button>
    <button style="background:green;" onclick="selectColor('green')"></button>
    <button style="background:yellow;" onclick="selectColor('yellow')"></button>
  </div>
  <input type="color" id="colorPicker" value="#ff0000">
  <button onclick="startGame()">Play</button>
</div>
<div id="joystick"><div id="stick"></div></div>
<canvas id="game"></canvas>
<script>
// --- Game variables ---
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let snake = { x:canvas.width/2, y:canvas.height/2, body:[], length:20, speed:3, color:'red', dx:0, dy:0 };
let foods = [];
let gameInterval;
let keys = {};
let joystick = { active:false, x:0, y:0, dx:0, dy:0 };
let gameRunning = false;

// --- Sounds ---
const eatSound = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='); // short pop
const bgHum = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='); // silent placeholder
bgHum.loop = true;

// --- Skin selection ---
function selectColor(c){ snake.color = c; document.getElementById('colorPicker').value = c; }
document.getElementById('colorPicker').addEventListener('input', e=>{ snake.color = e.target.value; });

// --- Start game ---
function startGame(){
  document.getElementById('ui').style.display = 'none';
  gameRunning = true;
  bgHum.play();
  for(let i=0;i<100;i++) spawnFood();
  gameInterval = requestAnimationFrame(gameLoop);
}

// --- Spawn food ---
function spawnFood(){
  foods.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:5+Math.random()*5, color:'#'+Math.floor(Math.random()*16777215).toString(16) });
}

// --- Input ---
window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()]=true; });
window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()]=false; });

// --- Mobile joystick ---
const stickEl = document.getElementById('stick');
const joyEl = document.getElementById('joystick');
joyEl.addEventListener('pointerdown', e=>{ joystick.active=true; joystick.x=e.clientX; joystick.y=e.clientY; });
window.addEventListener('pointerup', e=>{ joystick.active=false; joystick.dx=0; joystick.dy=0; stickEl.style.transform='translate(0,0)'; });
window.addEventListener('pointermove', e=>{ 
  if(joystick.active){
    let dx = e.clientX - joystick.x;
    let dy = e.clientY - joystick.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist>50){ dx=dx/dist*50; dy=dy/dist*50; }
    joystick.dx = dx/50;
    joystick.dy = dy/50;
    stickEl.style.transform = `translate(${dx}px,${dy}px)`;
  }
});

// --- Game loop ---
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGrid();
  handleInput();
  moveSnake();
  drawFoods();
  drawSnake();
  checkCollisions();
  if(gameRunning) requestAnimationFrame(gameLoop);
}

// --- Draw grid ---
function drawGrid(){
  ctx.strokeStyle='rgba(255,255,255,0.05)';
  ctx.lineWidth=1;
  const step=50;
  for(let x=0;x<canvas.width;x+=step){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  for(let y=0;y<canvas.height;y+=step){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
}

// --- Input handling ---
function handleInput(){
  let speed=snake.speed;
  let dx=0, dy=0;
  if(keys['w']) dy-=1;
  if(keys['s']) dy+=1;
  if(keys['a']) dx-=1;
  if(keys['d']) dx+=1;
  dx += joystick.dx;
  dy += joystick.dy;
  let len = Math.sqrt(dx*dx+dy*dy);
  if(len>0){ snake.dx = dx/len*speed; snake.dy = dy/len*speed; }
}

// --- Move snake ---
function moveSnake(){
  snake.x += snake.dx;
  snake.y += snake.dy;
  snake.body.push({x:snake.x,y:snake.y});
  while(snake.body.length>snake.length) snake.body.shift();
}

// --- Draw snake ---
function drawSnake(){
  ctx.fillStyle=snake.color;
  for(let i=0;i<snake.body.length;i++){
    ctx.beginPath();
    ctx.arc(snake.body[i].x, snake.body[i].y, 10, 0, Math.PI*2);
    ctx.fill();
  }
}

// --- Draw foods ---
function drawFoods(){
  for(let food of foods){
    ctx.fillStyle=food.color;
    ctx.beginPath();
    ctx.arc(food.x, food.y, food.size, 0, Math.PI*2);
    ctx.fill();
  }
}

// --- Collisions ---
function checkCollisions(){
  // Self collision
  for(let i=0;i<snake.body.length-10;i++){
    let dx = snake.x - snake.body[i].x;
    let dy = snake.y - snake.body[i].y;
    if(Math.sqrt(dx*dx+dy*dy)<10){
      gameOver();
      return;
    }
  }
  // Food collision
  for(let i=foods.length-1;i>=0;i--){
    let dx = snake.x - foods[i].x;
    let dy = snake.y - foods[i].y;
    if(Math.sqrt(dx*dx+dy*dy)<10+foods[i].size){
      snake.length += 2;
      foods.splice(i,1);
      spawnFood();
      eatSound.play();
    }
  }
}

// --- Game over ---
function gameOver(){
  gameRunning=false;
  bgHum.pause();
  alert('Game Over! Your length: '+snake.length);
  window.location.reload();
}

// --- Resize ---
window.addEventListener('resize',()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; });
</script>
</body>
</html>
