<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slither.io</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; background:#000; }
  #leaderboard {
    position:fixed; top:10px; right:10px;
    background:rgba(0,0,0,0.6); color:white;
    padding:10px 20px; border-radius:10px;
    font-family:monospace; font-size:16px;
  }
  #minimapCanvas {
    position:fixed; top:10px; left:10px;
    width:150px; height:150px;
    border:2px solid red;
    border-radius:10px;
    background:rgba(0,0,0,0.6);
  }
  #startScreen {
    position:fixed; inset:0; background:#000c;
    display:flex; flex-direction:column;
    justify-content:center; align-items:center;
    color:white; font-family:sans-serif;
  }
  #startScreen h1 { font-size:50px; margin:0 0 20px; }
  #startBtn {
    background:#0f0; border:none;
    padding:15px 40px; font-size:20px;
    border-radius:10px; cursor:pointer;
  }
  #startBtn:hover { background:#3f3; }
  #nameInput, #colorInput {
    margin:10px; padding:10px;
    border-radius:5px; border:none;
    font-size:16px;
  }

  /* Joystick */
  #joystickBase {
    position:fixed;
    bottom:60px; left:60px;
    width:120px; height:120px;
    border-radius:50%;
    background:rgba(255,255,255,0.1);
    border:2px solid rgba(255,255,255,0.2);
    display:none;
    touch-action:none;
  }
  #joystickStick {
    position:absolute;
    width:60px; height:60px;
    border-radius:50%;
    background:rgba(0,255,255,0.5);
    top:30px; left:30px;
    touch-action:none;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<canvas id="minimapCanvas" width="150" height="150"></canvas>
<div id="leaderboard"></div>

<!-- Start screen -->
<div id="startScreen">
  <h1>Slither.io By Josh J</h1>
  <input id="nameInput" type="text" placeholder="Enter your name" />
  <input id="colorInput" type="color" value="#00ffff" />
  <button id="startBtn">Start Game</button>
</div>

<!-- Mobile Joystick -->
<div id="joystickBase">
  <div id="joystickStick"></div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const leaderboard = document.getElementById('leaderboard');
const startScreen = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');
const nameInput = document.getElementById('nameInput');
const colorInput = document.getElementById('colorInput');
const joystickBase = document.getElementById('joystickBase');
const joystickStick = document.getElementById('joystickStick');
const minimapCanvas = document.getElementById('minimapCanvas');
const mctx = minimapCanvas.getContext('2d');

let running = false;
const MAP_SIZE = 5000;
let player, ais, food;
const NUM_AIS = 12;
const NUM_FOOD = 200;
const AI_NAMES = [
  "Shadow","Spark","Nibbler","SlimeLord","Pixel","Venom","Dash","Glitch","Ghost","Nova",
  "Bit","Echo","Zoom","Laser","Orbit","Zig","Byte","Razor","Flick","Vortex"
];

function randomColor() { return `hsl(${Math.random()*360},100%,50%)`; }
function randomName() { return AI_NAMES[Math.floor(Math.random()*AI_NAMES.length)]; }
function distance(a,b){ return Math.hypot(a.x-b.x, a.y-b.y); }

function createSnake(name, color, x, y, ai=false) {
  return {
    name, color,
    snake: [{x, y}],
    angle: Math.random()*Math.PI*2,
    targetAngle: 0,
    length: 100,
    baseSpeed: ai ? 2.5 + Math.random()*1.5 : 3.5,
    speed: 0,
    score: 0,
    ai,
    boosting: false,
    thickness: 10
  };
}

function resetGame(){
  player = createSnake(nameInput.value || "You", colorInput.value, MAP_SIZE/2, MAP_SIZE/2, false);
  ais = [];
  food = [];
  for(let i=0;i<NUM_AIS;i++)
    ais.push(createSnake(randomName(), randomColor(), Math.random()*MAP_SIZE, Math.random()*MAP_SIZE, true));
  for(let i=0;i<NUM_FOOD;i++)
    food.push({x:Math.random()*MAP_SIZE, y:Math.random()*MAP_SIZE});
}

// mouse control
window.addEventListener("mousemove", e=>{
  if(!running) return;
  const dx = e.clientX - canvas.width/2;
  const dy = e.clientY - canvas.height/2;
  player.targetAngle = Math.atan2(dy, dx);
});

function updateSnake(s){
  if(s.boosting){
    s.speed = s.baseSpeed * 2.4;
    s.length -= 0.15;
  } else {
    s.speed = s.baseSpeed;
  }

  let diff = s.targetAngle - s.angle;
  if(diff > Math.PI) diff -= Math.PI*2;
  if(diff < -Math.PI) diff += Math.PI*2;
  s.angle += diff*0.15;

  const head = {
    x: s.snake[0].x + Math.cos(s.angle)*s.speed,
    y: s.snake[0].y + Math.sin(s.angle)*s.speed
  };
  s.snake.unshift(head);

  while(s.snake.length > s.length) s.snake.pop();

  s.thickness = 8 + s.length / 50;

  for(let i=food.length-1;i>=0;i--){
    if(distance(head, food[i]) < 12){
      s.length += 2;
      s.score += 10;
      food[i] = {x:Math.random()*MAP_SIZE, y:Math.random()*MAP_SIZE};
    }
  }
}

function aiLogic(ai){
  let nearest=null, minDist=Infinity;
  for(const f of food){
    let d=distance(ai.snake[0], f);
    if(d<minDist){minDist=d; nearest=f;}
  }
  if(nearest){
    ai.targetAngle=Math.atan2(nearest.y-ai.snake[0].y, nearest.x-ai.snake[0].x);
  }

  const distToPlayer = distance(ai.snake[0], player.snake[0]);
  if(distToPlayer < 150){
    ai.targetAngle = Math.atan2(ai.snake[0].y - player.snake[0].y, ai.snake[0].x - player.snake[0].x);
    ai.boosting = true;
  } else {
    ai.boosting = false;
  }
}

function dropFood(snake, extra=1){
  const dropCount = Math.floor(snake.length/4 * extra);
  for(let i=0;i<dropCount;i++){
    food.push({
      x: snake.snake[i]?.x || snake.snake[0].x,
      y: snake.snake[i]?.y || snake.snake[0].y
    });
  }
}

function checkCollisions(){
  const allSnakes = [player,...ais];
  for(const s of allSnakes){
    const head = s.snake[0];
    for(const other of allSnakes){
      if(s===other) continue;
      for(let i=0;i<other.snake.length;i++){
        if(distance(head, other.snake[i]) < other.thickness){
          dropFood(s, s.ai ? 2 : 1);
          if(s===player){
            alert("💀 You died nigger! Final Score: "+player.score);
            resetGame();
          }else{
            Object.assign(s, createSnake(randomName(), randomColor(), Math.random()*MAP_SIZE, Math.random()*MAP_SIZE, true));
          }
          return;
        }
      }
    }
  }
}

function drawSnake(s, cameraX, cameraY){
  for(let i=0;i<s.snake.length;i++){
    const seg=s.snake[i];
    const x=seg.x-cameraX+canvas.width/2;
    const y=seg.y-cameraY+canvas.height/2;
    const radius = s.thickness * (0.5 + 0.5*(i/s.snake.length));
    ctx.fillStyle=s.color;
    ctx.beginPath();
    ctx.arc(x,y,radius,0,Math.PI*2);
    ctx.fill();
  }
}

function drawFood(cameraX, cameraY){
  ctx.fillStyle="red";
  for(const f of food){
    const x=f.x-cameraX+canvas.width/2;
    const y=f.y-cameraY+canvas.height/2;
    ctx.beginPath();
    ctx.arc(x,y,6,0,Math.PI*2);
    ctx.fill();
  }
}

function drawLeaderboard(){
  const all=[player,...ais].sort((a,b)=>b.score-a.score);
  leaderboard.innerHTML=`<b>Leaderboard</b><br>`+
    all.map((s,i)=>`${i+1}. ${s.name} - <span style="color:red">${s.score}</span>`).join("<br>");
}

function drawMinimap(){
  const scale = minimapCanvas.width / MAP_SIZE;
  mctx.clearRect(0,0,minimapCanvas.width,minimapCanvas.height);

  ais.forEach(s=>{
    const x = s.snake[0].x * scale;
    const y = s.snake[0].y * scale;
    mctx.fillStyle = "red";
    mctx.fillRect(x, y, 4, 4);
  });

  const px = player.snake[0].x * scale;
  const py = player.snake[0].y * scale;
  mctx.fillStyle = "yellow";
  mctx.fillRect(px, py, 4, 4);
}

function gameLoop(){
  if(!running) return;
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const cameraX = player.snake[0].x;
  const cameraY = player.snake[0].y;

  updateSnake(player);
  for(const ai of ais){ aiLogic(ai); updateSnake(ai); }

  checkCollisions();
  drawFood(cameraX, cameraY);
  drawSnake(player, cameraX, cameraY);
  for(const ai of ais) drawSnake(ai, cameraX, cameraY);
  drawLeaderboard();
  drawMinimap();

  requestAnimationFrame(gameLoop);
}

window.addEventListener("keydown", e=>{
  if(e.code==="Space") player.boosting=true;
});
window.addEventListener("keyup", e=>{
  if(e.code==="Space") player.boosting=false;
});

startBtn.onclick=()=>{
  startScreen.style.display="none";
  joystickBase.style.display="block";
  resetGame();
  running=true;
  gameLoop();
};

// 🕹️ Touch joystick
let joyActive = false;
let joyCenter = {x:0,y:0};
let lastTap = 0;

joystickBase.addEventListener("touchstart", e=>{
  e.preventDefault();
  const now = Date.now();
  if(now - lastTap < 300){ player.boosting = true; setTimeout(()=>player.boosting=false, 1000); }
  lastTap = now;
  joyActive = true;
  const touch = e.touches[0];
  joyCenter = {x:touch.clientX, y:touch.clientY};
  joystickBase.style.left = joyCenter.x - 60 + "px";
  joystickBase.style.top = joyCenter.y - 60 + "px";
});

joystickBase.addEventListener("touchmove", e=>{
  if(!joyActive) return;
  const touch = e.touches[0];
  const dx = touch.clientX - joyCenter.x;
  const dy = touch.clientY - joyCenter.y;
  const dist = Math.min(50, Math.hypot(dx, dy));
  const angle = Math.atan2(dy, dx);
  joystickStick.style.left = 30 + Math.cos(angle)*dist + "px";
  joystickStick.style.top = 30 + Math.sin(angle)*dist + "px";
  player.targetAngle = angle;
});

joystickBase.addEventListener("touchend", e=>{
  joyActive = false;
  joystickStick.style.left = "30px";
  joystickStick.style.top = "30px";
});
</script>
</body>
</html>
