<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slither.io</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:sans-serif; }
canvas { display:block; background:#111; }
#leaderboard { position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.6); color:white; padding:10px 20px; border-radius:10px; font-family:monospace; font-size:16px; }
#minimapCanvas { position:fixed; top:10px; left:10px; width:150px; height:150px; border:2px solid red; border-radius:10px; background:rgba(0,0,0,0.6); }
#startScreen { position:fixed; inset:0; background:#000c; display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; }
#startScreen h1 { font-size:40px; margin-bottom:20px; text-shadow:0 0 10px lime; }
#startBtn { background:#0f0; border:none; padding:15px 40px; font-size:20px; border-radius:10px; cursor:pointer; margin-top:10px; }
#startBtn:hover { background:#3f3; }
#nameInput, #colorInput { margin:10px; padding:10px; border-radius:5px; border:none; font-size:16px; }
label { font-size:16px; margin-left:5px; }
#joystickBase { position:fixed; bottom:60px; left:60px; width:120px; height:120px; border-radius:50%; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.2); display:none; touch-action:none; }
#joystickStick { position:absolute; width:60px; height:60px; border-radius:50%; background:rgba(0,255,255,0.5); top:30px; left:30px; touch-action:none; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<canvas id="minimapCanvas" width="150" height="150"></canvas>
<div id="leaderboard"></div>

<div id="startScreen">
  <h1>Slither.io By Josh J</h1>
  <input id="nameInput" type="text" placeholder="Enter your name" />
  <div>
    <input id="colorInput" type="color" value="#00ffff" />
    <label for="colorInput">Choose Worm Color</label>
  </div>
  <button id="startBtn">Start Game</button>
</div>

<div id="joystickBase">
  <div id="joystickStick"></div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const leaderboard = document.getElementById('leaderboard');
const startScreen = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');
const nameInput = document.getElementById('nameInput');
const colorInput = document.getElementById('colorInput');
const joystickBase = document.getElementById('joystickBase');
const joystickStick = document.getElementById('joystickStick');
const minimapCanvas = document.getElementById('minimapCanvas');
const mctx = minimapCanvas.getContext('2d');

let running = false;
const MAP_SIZE = 5000;
const MAP_RADIUS = MAP_SIZE/2;
let player, ais, food;
const NUM_AIS = 12;
const NUM_FOOD = 200;
const AI_NAMES = ["Shadow","Spark","Nigger","SlimeLord","Pixel","Venom","Dash","Glitch","Ghost","Nova","Bit","Echo","Zoom","Laser","Orbit","Zig","Byte","Razor","Flick","Vortex"];

function randomColor() { return `hsl(${Math.random()*360},100%,50%)`; }
function randomName() { return AI_NAMES[Math.floor(Math.random()*AI_NAMES.length)]; }
function distance(a,b){ return Math.hypot(a.x-b.x, a.y-b.y); }

function createSnake(name, color, x, y, ai=false) {
  return { 
    name, color, snake:[{x,y}], angle:Math.random()*Math.PI*2, targetAngle:0, length:100, 
    baseSpeed:ai?2.5+Math.random()*1.5:2.8, speed:0, score:0, ai, boosting:false, thickness:10 
  };
}

function resetGame(){
  player = createSnake(nameInput.value||"You", colorInput.value, 0, 0, false);
  ais = []; food = [];
  for(let i=0;i<NUM_AIS;i++) ais.push(createSnake(randomName(), randomColor(), Math.random()*MAP_SIZE-MAP_RADIUS, Math.random()*MAP_SIZE-MAP_RADIUS,true));
  for(let i=0;i<NUM_FOOD;i++) food.push({x:Math.random()*MAP_SIZE-MAP_RADIUS, y:Math.random()*MAP_SIZE-MAP_RADIUS});
}

const keys = {ArrowUp:false,ArrowDown:false,ArrowLeft:false,ArrowRight:false,W:false,A:false,S:false,D:false};
window.addEventListener("keydown", e=>{
  if(keys.hasOwnProperty(e.code)) keys[e.code]=true;
  if(e.key.toLowerCase()==="w") keys.W=true;
  if(e.key.toLowerCase()==="a") keys.A=true;
  if(e.key.toLowerCase()==="s") keys.S=true;
  if(e.key.toLowerCase()==="d") keys.D=true;
  if(e.code==="Space"||e.code==="ShiftLeft") player.boosting=true;
});
window.addEventListener("keyup", e=>{
  if(keys.hasOwnProperty(e.code)) keys[e.code]=false;
  if(e.key.toLowerCase()==="w") keys.W=false;
  if(e.key.toLowerCase()==="a") keys.A=false;
  if(e.key.toLowerCase()==="s") keys.S=false;
  if(e.key.toLowerCase()==="d") keys.D=false;
  if(e.code==="Space"||e.code==="ShiftLeft") player.boosting=false;
});

window.addEventListener("mousemove", e=>{
  if(!running) return;
  player.targetAngle = Math.atan2(e.clientY-canvas.height/2, e.clientX-canvas.width/2);
});

function updateSnake(s){
  s.speed = s.boosting ? s.baseSpeed*2.4 : s.baseSpeed;

  if(!s.ai){
    let dx=0, dy=0;
    if(keys.ArrowUp||keys.W) dy-=1;
    if(keys.ArrowDown||keys.S) dy+=1;
    if(keys.ArrowLeft||keys.A) dx-=1;
    if(keys.ArrowRight||keys.D) dx+=1;
    if(dx!==0 || dy!==0) s.targetAngle=Math.atan2(dy,dx);
  }

  if(s.ai){
    const distToCenter = Math.hypot(s.snake[0].x, s.snake[0].y);
    const margin = 200;
    if(distToCenter > MAP_RADIUS-margin){
      const angleFromCenter = Math.atan2(s.snake[0].y, s.snake[0].x);
      s.targetAngle = angleFromCenter + Math.PI + (Math.random()*0.5-0.25);
    }
  }

  let diff = s.targetAngle-s.angle; if(diff>Math.PI) diff-=2*Math.PI; if(diff<-Math.PI) diff+=2*Math.PI;
  s.angle += diff*0.15;

  let head = { x:s.snake[0].x+Math.cos(s.angle)*s.speed, y:s.snake[0].y+Math.sin(s.angle)*s.speed };
  const distToCenter = Math.hypot(head.x, head.y);
  if(distToCenter+s.thickness>MAP_RADIUS){
    const angleFromCenter = Math.atan2(head.y, head.x);
    const over = distToCenter+s.thickness-MAP_RADIUS;
    head.x -= Math.cos(angleFromCenter)*over;
    head.y -= Math.sin(angleFromCenter)*over;
  }

  s.snake.unshift(head);
  while(s.snake.length > s.length) s.snake.pop();
  s.thickness = 8 + s.length/50;

  for(let i=food.length-1;i>=0;i--){
    const d = distance(head, food[i]);
    if(d<40){ 
      food[i].x -= (food[i].x-head.x)*0.08; 
      food[i].y -= (food[i].y-head.y)*0.08;
    }
    if(d<20){ 
      s.length += 2; 
      s.thickness += 0.05; 
      s.score += 10; 
      food[i] = {x:Math.random()*MAP_SIZE-MAP_RADIUS, y:Math.random()*MAP_SIZE-MAP_RADIUS}; 
    }
  }
}

function aiLogic(ai){
  let nearest = null, minDist = Infinity;
  for(const f of food){ const d=distance(ai.snake[0],f); if(d<minDist){ minDist=d; nearest=f; } }
  if(nearest) ai.targetAngle = Math.atan2(nearest.y-ai.snake[0].y, nearest.x-ai.snake[0].x);
  ai.boosting = distance(ai.snake[0],player.snake[0])<150;
}

function dropFood(snake, extra=1){
  const dropCount=Math.floor(snake.length/4*extra);
  for(let i=0;i<dropCount;i++)
    food.push({x:snake.snake[i]?.x||snake.snake[0].x, y:snake.snake[i]?.y||snake.snake[0].y});
}

function checkCollisions(){
  const all=[player,...ais];
  for(const s of all){
    const head = s.snake[0];
    for(const other of all){
      if(s===other) continue;
      for(let i=0;i<other.snake.length;i++){
        if(distance(head,other.snake[i])<other.thickness){
          if(s===player){
            running=false;
            startScreen.style.display="flex";
            joystickBase.style.display="none";
            return;
          } else {
            dropFood(s,2); // AI drops food on death
            Object.assign(s, createSnake(AI_NAMES[Math.floor(Math.random()*AI_NAMES.length)], randomColor(), Math.random()*MAP_SIZE-MAP_RADIUS, Math.random()*MAP_SIZE-MAP_RADIUS,true));
          }
        }
      }
    }
  }
}

function drawFloor(camX, camY){
  const size=50; const cols=Math.ceil(canvas.width/size)+2; const rows=Math.ceil(canvas.height/size)+2;
  ctx.strokeStyle="rgba(100,255,100,0.2)"; ctx.lineWidth=1;
  for(let i=-1;i<cols;i++){ for(let j=-1;j<rows;j++){
    const x=i*size-(camX%size)+canvas.width/2; const y=j*size-(camY%size)+canvas.height/2;
    ctx.beginPath();
    for(let k=0;k<5;k++){
      const angle=k*2*Math.PI/5-Math.PI/2;
      const px=x+Math.cos(angle)*size/2; const py=y+Math.sin(angle)*size/2;
      if(k===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
    }
    ctx.closePath(); ctx.stroke();
  }}
}

function drawSnake(s, camX, camY){
  for(let i=0;i<s.snake.length;i++){
    const seg=s.snake[i]; const x=seg.x-camX+canvas.width/2; const y=seg.y-camY+canvas.height/2;
    const r=s.thickness*(0.5+0.5*i/s.snake.length);
    ctx.fillStyle = s.color;
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
  }
  const head=s.snake[0]; const hx=head.x-camX+canvas.width/2; const hy=head.y-camY+canvas.height/2;
  const hr=s.thickness*1.2; ctx.fillStyle = s.color;
  ctx.beginPath(); ctx.arc(hx,hy,hr,0,Math.PI*2); ctx.fill();
}

function drawFood(camX, camY){
  for(const f of food){
    const x=f.x-camX+canvas.width/2; const y=f.y-camY+canvas.height/2;
    const hue = Math.random()*360;
    ctx.fillStyle=`hsl(${hue},100%,50%)`;
    ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2); ctx.fill();
  }
}

function drawBarrier(){
  ctx.strokeStyle="rgba(255,0,0,0.6)";
  ctx.lineWidth=10;
  ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, MAP_RADIUS, 0, Math.PI*2); ctx.stroke();
}

function drawLeaderboard(){
  const all=[player,...ais].sort((a,b)=>b.score-a.score);
  leaderboard.innerHTML=`<b>Leaderboard</b><br>`+all.map((s,i)=>`${i+1}. ${s.name} - <span style="color:red">${s.score}</span>`).join("<br>");
}

function drawMinimap(){
  const scale=minimapCanvas.width/MAP_SIZE;
  mctx.clearRect(0,0,minimapCanvas.width,minimapCanvas.height);
  ais.forEach(s=>{
    const x=s.snake[0].x*scale+minimapCanvas.width/2;
    const y=s.snake[0].y*scale+minimapCanvas.height/2;
    mctx.fillStyle="red"; mctx.fillRect(x,y,4,4);
  });
  const px=player.snake[0].x*scale+minimapCanvas.width/2;
  const py=player.snake[0].y*scale+minimapCanvas.height/2;
  mctx.fillStyle="yellow"; mctx.fillRect(px,py,4,4);
}

function gameLoop(){
  if(!running) return;
  ctx.fillStyle="rgba(0,0,0,0.3)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const camX=player.snake[0].x; const camY=player.snake[0].y;
  drawFloor(camX,camY);
  updateSnake(player); ais.forEach(ai=>{ aiLogic(ai); updateSnake(ai); });
  checkCollisions();
  drawFood(camX,camY); drawSnake(player,camX,camY); ais.forEach(ai=>drawSnake(ai,camX,camY));
  drawBarrier(); drawLeaderboard(); drawMinimap();
  requestAnimationFrame(gameLoop);
}

startBtn.onclick=()=>{
  startScreen.style.display="none"; joystickBase.style.display="block";
  resetGame(); running=true; gameLoop();
};

// Mobile joystick
let joyActive=false; let joyCenter={x:0,y:0};
joystickBase.addEventListener("touchstart",e=>{ e.preventDefault(); joyActive=true; const touch=e.touches[0]; joyCenter={x:touch.clientX,y:touch.clientY}; joystickBase.style.left=joyCenter.x-60+"px"; joystickBase.style.top=joyCenter.y-60+"px"; });
joystickBase.addEventListener("touchmove",e=>{ if(!joyActive)return; const touch=e.touches[0]; const dx=touch.clientX-joyCenter.x; const dy=touch.clientY-joyCenter.y; const dist=Math.min(50,Math.hypot(dx,dy)); const angle=Math.atan2(dy,dx); joystickStick.style.left=30+Math.cos(angle)*dist+"px"; joystickStick.style.top=30+Math.sin(angle)*dist+"px"; player.targetAngle=angle; });
joystickBase.addEventListener("touchend",()=>{ joyActive=false; joystickStick.style.left="30px"; joystickStick.style.top="30px"; });
colorInput.addEventListener("input",()=>{ if(player) player.color=colorInput.value; });
</script>
</body>
</html>
